<template>
  <div class="svg-container">
    <div class="flex flex-center">
      <p><span style="font-weight: 600; font-size: 30px;">Leia tamb√©m alguns artigos sobre</span>
        <span style="font-weight: 700; font-size: 35px; color: #7BB542"> Plantas Bioativas</span></p>
    </div>
    <svg @wheel="onWheel" width="100%" height="100%"
         viewBox="0 0 1920 600" preserveAspectRatio="xMidYMid meet">
      <path
        d="M139 101.84V96.9568V89.9815L140.009 80.9136L141.523 72.5432L143.037 66.963L145.56 60.6852L149.093 52.3148L151.111 47.4321L155.653 37.6667L161.204 28.5988L165.746 22.321L170.287 16.7407L172.811 13.9506L174.767 12.1479C175.48 11.4912 176.254 10.9051 177.08 10.3978L180.38 8.37037L184.417 6.27778L186.94 5.58025L187.734 5.42346C188.554 5.15995 189.35 4.82617 190.114 4.4255L198.547 0L1757.03 2.97146C1765.3 2.98723 1772 9.69832 1772 17.9714V98C1772 106.284 1765.28 113 1757 113H150.161C143.997 113 139 108.003 139 101.84Z"
        fill="#7BB542"/>
      <path
        d="M150.431 174.279L143.542 202.435C141.23 211.884 148.385 221 158.113 221H1757C1765.28 221 1772 214.284 1772 206V126C1772 117.716 1765.28 111 1757 111H154.342C152.361 111 150.548 112.116 149.656 113.884C149.286 114.618 149.093 115.428 149.093 116.25V134.5L150.753 151.714C150.988 154.155 150.621 156.617 149.684 158.884L149.093 160.315L146.868 165.587C146.131 167.332 146.87 169.349 148.559 170.206C150.054 170.964 150.829 172.652 150.431 174.279Z"
        fill="#7BB542" fill-opacity="0.9"/>
      <path
        d="M123.604 498.194L116.733 525.317C114.332 534.795 121.496 544 131.274 544H1757C1765.28 544 1772 537.284 1772 529V451C1772 442.716 1765.28 436 1757 436H127.465C125.527 436 123.749 437.077 122.851 438.795C122.463 439.539 122.26 440.366 122.26 441.205V459.073L123.928 475.782C124.18 478.302 123.789 480.846 122.792 483.174L122.26 484.418L120.03 489.52C119.269 491.263 120.015 493.296 121.723 494.132C123.231 494.871 124.016 496.566 123.604 498.194Z"
        fill="#7BB542" fill-opacity="0.6"/>
      <path
        d="M129.707 389.374L115.077 413.136C108.924 423.13 116.114 436 127.85 436H1757C1765.28 436 1772 429.284 1772 421V341C1772 332.716 1765.28 326 1757 326H134.7C132.721 326 130.91 327.109 130.009 328.871C129.631 329.613 129.433 330.434 129.433 331.267V349.5L131.109 366.671C131.35 369.14 130.975 371.63 130.017 373.918L129.433 375.315L127.001 381.01C126.358 382.513 126.997 384.256 128.459 384.988C130.081 385.801 130.658 387.829 129.707 389.374Z"
        fill="#7BB542" fill-opacity="0.7"/>
      <path
        d="M150.409 281.489L143.799 307.276C141.367 316.764 148.534 326 158.33 326H1757C1765.28 326 1772 319.284 1772 311V236C1772 227.716 1765.28 221 1757 221H154.171C152.289 221 150.561 222.041 149.681 223.705C149.295 224.436 149.093 225.251 149.093 226.078V243.432L150.719 259.527C150.976 262.075 150.577 264.646 149.559 266.996L149.093 268.073L146.911 273.008C146.157 274.712 146.89 276.707 148.567 277.518C150.047 278.235 150.818 279.895 150.409 281.489Z"
        fill="#7BB542" fill-opacity="0.8"/>
      <path
        d="M166.57 544H104.591V542.059C104.591 542.059 105.71 537.212 104.591 534.295C103.007 530.17 100.823 526.567 98.7801 522.65C96.1115 517.534 94.2999 514.292 92 509C89.0257 502.156 88.9003 501.718 87 494.5C85.2528 487.863 84.0416 482.89 83.2852 476.068C82.5288 469.247 81.7638 465.451 81.3483 458.6C80.8436 450.278 83.1 444.761 79.4115 437.25C76.235 430.783 72.6539 429.293 66.5739 424.021C61.3007 419.448 58.201 416.319 52.7043 412.019C47.5757 408.006 45.1454 406.222 39.3391 403.279C31.6433 399.379 29.1192 397.643 20.9304 394.932C14.7941 392.9 0 390.669 0 390.669C0 390.669 15.4235 389.435 25.1792 390.669C34.4617 391.843 39.8452 392.744 48.4216 396.491C54.0117 398.934 56.4877 401.599 61.9797 404.255C69.9528 408.111 83.2852 412.019 83.2852 412.019C83.2852 412.019 86.7467 406.055 89.0958 402.314C92.0009 397.688 93.8177 395.216 96.8433 390.669L104.591 379.023L112.338 367.378C112.338 367.378 118.768 358.214 122.022 351.851C124.649 346.713 126.374 343.849 127.833 338.264C130.323 328.732 129.654 322.716 127.833 313.033C127.256 309.961 126.965 308.205 125.896 305.269C124.737 302.085 123.948 300.292 122.022 297.505C119.587 293.98 114.275 289.742 114.275 289.742C114.275 289.742 108.519 283.675 104.591 280.037C97.4771 273.449 93.2668 269.917 85.2221 264.51C82.9254 263.036 58.2078 248.185 55.7304 247.042C51.551 245.114 48.4416 244.269 44.1304 242.658C39.9977 241.115 32.9267 239.278 32.9267 239.278C32.9267 239.278 50.6865 238.183 61.9797 239.278C67.3033 239.794 70.3809 239.797 75.5377 241.219C81.0919 242.75 83.8143 244.737 89.0958 247.042C95.9259 250.022 100.266 250.761 106.528 254.805C111.493 258.013 118.149 264.51 118.149 264.51C118.149 264.51 115.527 248.775 118.149 239.278C119.235 235.344 120.181 233.214 122.022 229.574C124.489 224.699 126.893 222.572 129.77 217.928C132.986 212.736 135.271 210.023 137.517 204.342C140.633 196.464 143.602 192.149 144.496 183.722C145.775 171.662 145.506 163.342 141.391 151.938C139.318 146.191 138.363 143.376 135.581 137.938C132.182 131.295 129.834 127.22 125.896 120.883C121.082 113.135 119.207 109.662 113.226 102.779C108.646 97.5088 100.365 88.8668 100.365 88.8668L87.7565 79.2548L75.5377 70.4197C78.1202 71.0666 81.5769 72.3903 85.9913 73.69C92.4823 75.6012 98.2567 78.4376 102.13 81.0255C106.004 83.6133 110.876 86.6184 116 90.6374C124.013 96.923 135.581 107.297 135.581 107.297C135.581 107.297 135.207 99.0031 135.581 93.7105C135.958 88.3642 136.683 85.4183 137.517 80.1242C138.836 71.7535 138.821 66.8479 141.391 58.7743C144.475 49.0859 147.263 43.8633 153.012 35.4834C158.172 27.9623 162.017 24.4186 168.507 18.0153C174.237 12.3626 177.382 9.00215 184.002 4.42903C187.633 1.92054 190.432 1.74387 194.678 0.547255C199.047 -0.684047 205.522 0.547218 205.522 0.547218L214.992 2.48813C214.992 2.48813 204.41 3.49428 201.434 4.42898L201.061 4.54617C197.4 5.69489 195.192 6.38793 191.75 8.31078C186.59 11.1931 184.308 13.8319 180.128 18.0153C172.849 25.3007 169.625 30.3506 164.634 39.3652C161.019 45.8927 158.055 51.4017 156.886 58.7743C156.174 63.2657 155.843 65.8719 155.843 70.4197V86.5903C155.843 97.2018 154.542 106.653 156.886 117.001C158.317 123.317 160.84 126.325 162.697 132.529C164.7 139.222 165.565 143.082 166.57 149.997C168.534 163.497 166.57 184.933 166.57 184.933C166.57 184.933 174.117 182.14 178.192 179.11C181.628 176.555 184.266 175.589 187.876 173.287C191.912 170.714 193.468 170.204 197.957 168.545C201.778 167.132 208.902 165.561 212.835 164.498C221.598 162.13 232 166.521 232 166.521C232 166.521 220.774 164.594 214.6 167.465C210.315 169.457 206.511 170.537 202.243 173.287C198.17 175.913 194.998 178.702 191.4 181.951C188.222 184.822 187.247 187.153 184.339 190.298C180.324 194.641 178.732 197.302 174.757 201.681C170.437 206.438 168.699 209.069 164.67 214.075C161.246 218.33 160.25 220.935 158.113 225.964C158.113 225.964 156.797 229.45 156.348 231.782C155.364 236.893 153 242.694 153 248C153 259.37 157.677 281.206 158.823 285.86C159.969 290.514 161.236 292.94 162.697 297.505C165.108 305.041 167.587 309.335 168.507 317.195C169.124 322.464 168.507 330.501 168.507 330.501C168.507 330.501 167.815 337.451 167.443 341.983C167.067 346.579 165.304 348.971 163.913 353.366C162.379 358.213 155.843 374.361 155.843 374.361C155.843 374.361 167.607 370.921 175.261 367.378C181.971 364.272 189.884 360.847 193.165 360.025C196.834 359.106 205.785 358.801 206.53 358.931C207.276 359.061 206.081 359.167 212.835 360.025C216.661 360.511 224.435 363.496 224.435 363.496C224.435 363.496 215.027 362.348 211.118 363.496C204.513 365.437 204.255 367.744 199.974 370.474C195.129 373.096 187.328 377.384 182.07 379.023C177.502 380.447 173.858 382.167 169.461 384.055C166.352 385.391 163.449 386.728 160.635 388.608C156.185 391.581 152.692 392.486 149.139 396.491C144.113 402.156 140.618 405.105 137.517 412.019C134.659 418.393 134.586 422.563 133.644 429.487C132.111 440.752 129.77 447.231 129.77 458.6C129.77 468.454 131.848 474.144 133.644 483.832C135.26 492.555 137.357 497.285 141.391 505.182C145.119 512.48 148.54 515.785 153.012 522.65C158.403 530.925 166.57 544 166.57 544Z"
        fill="black"/>
      <g v-for="(artigoValue) in artigoList" :key="artigoValue.index">
        <text
          x="250"
          :y="artigoValue.textY"
          font-weight="600"
          font-family="Montserrat, sans-serif"
          font-size="24"
          fill="white"
        >
          {{ artigoValue.label }}
        </text>
        <text
          x="1630"
          :y="artigoValue.textY"
          font-weight="600"
          font-family="Montserrat, sans-serif"
          font-size="24"
          fill="white"
        >Conferir
        </text>
        <rect
          x="1620"
          :y="artigoValue.y"
          width="125"
          height="40"
          @click="handleClick(artigoValue.link)"
          fill="transparent"
          stroke="white"
          rx="10"
          ry="10"
          style="cursor: pointer"
        />
      </g>
    </svg>
  </div>
</template>

<script lang="ts">

import ArtigosService from 'app/services/artigosService'
import { defineComponent, ref, UnwrapRef } from 'vue'
import { Artigo, ArtigosList, ArtigosListBkp } from 'components/models'

export default defineComponent({
  methods: {
    onWheel (event: { preventDefault: () => void; deltaY: number }) {
      event.preventDefault()
      if (event.deltaY > 0) {
        this.scrollDown()
      } else {
        this.scrollUp()
      }
    },
    scrollDown () {
      if (this.currentGroup < this.artigoList.length - 1) {
        this.currentGroup++
        this.updateArtigoList()
      }
    },
    scrollUp () {
      if (this.currentGroup > 0) {
        this.currentGroup--
        this.updateArtigoList()
      }
    },
    updateArtigoList () {
      if (this.groupedArtigos[this.currentGroup]) {
        this.setArtigosList(this.groupedArtigos[this.currentGroup])
      }
    }
  },
  setup () {
    const artigoList = ref<ArtigosList[]>([
      { index: 0, y: 35, textY: 65, label: '', link: '' },
      { index: 1, y: 145, textY: 175, label: '', link: '' },
      { index: 2, y: 250, textY: 280, label: '', link: '' },
      { index: 3, y: 360, textY: 390, label: '', link: '' },
      { index: 4, y: 470, textY: 500, label: '', link: '' }
    ])
    const artigoListIndexY: Array<ArtigosListBkp> = [
      { index: 0, y: 35, textY: 65 },
      { index: 1, y: 145, textY: 175 },
      { index: 2, y: 250, textY: 280 },
      { index: 3, y: 360, textY: 390 },
      { index: 4, y: 470, textY: 500 }
    ]
    const currentGroup = ref<number>(0)
    const groupedArtigos = ref<Array<Artigo[]>>([])
    ArtigosService.getAll({ ativo: true }).then((resp) => {
      groupedArtigos.value = chunkArray(resp.data, 5)
      setArtigosList(groupedArtigos.value[currentGroup.value])
    })
    const setArtigosList = (data: Array<Artigo>) => {
      artigoList.value.forEach((item: ArtigosList) => {
        const findSame = data.findIndex((artigo: Artigo, index: number) => index === item.index)
        if (findSame !== -1) {
          let titulo = data[findSame].titulo
          if (titulo.length > 82) {
            titulo = titulo.substring(0, 82) + '...'
          }
          const restore = artigoListIndexY[artigoListIndexY.findIndex((bkp: ArtigosListBkp) => bkp.index === item.index)]
          item.index = restore.index
          item.y = restore.y
          item.textY = restore.textY
          item.label = titulo
          item.link = data[findSame].link
        } else {
          item.textY = 90000
          item.y = 90000
          item.label = ''
          item.link = ''
        }
      })
    }
    const chunkArray = (array: Array<Artigo>, chunkSize: number): Array<Artigo[]> => {
      const result = []
      for (let i = 0; i < array.length; i += chunkSize) {
        result.push(array.slice(i, i + chunkSize))
      }
      return result
    }
    const handleClick = (valueClick: UnwrapRef<ArtigosList['link']> | undefined) => {
      window.open(valueClick, '_blank')
    }
    return {
      setArtigosList,
      currentGroup,
      groupedArtigos,
      handleClick,
      artigoList
    }
  }
})
</script>

<style scoped>
.svg-container {
  width: 100%;
  height: 100%;
  display: inline-block;
  position: relative;
}
</style>
